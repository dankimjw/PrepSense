{
  "timestamp": "2025-08-04T12:47:47.447925",
  "data_quality": {
    "foods": {
      "total_foods": 21841,
      "duplicate_descriptions": 10,
      "data_types": {
        "branded_food": 17996,
        "sub_sample_food": 3709,
        "experimental_food": 114,
        "sample_food": 15,
        "market_acquistion": 7
      }
    },
    "brand_data": {
      "branded_foods": 17996,
      "foods_with_brands": 17996,
      "foods_with_barcodes": 17996
    },
    "categories": {
      "total_categories": 28,
      "empty_categories": 26,
      "distribution": {
        "Snacks": 7288,
        "Alcoholic Beverages": 78,
        "Baby Foods": 0,
        "Fats and Oils": 0,
        "Poultry Products": 0,
        "Soups, Sauces, and Gravies": 0,
        "Sausages and Luncheon Meats": 0,
        "Breakfast Cereals": 0,
        "Fruits and Fruit Juices": 0,
        "Pork Products": 0,
        "Vegetables and Vegetable Products": 0,
        "Nut and Seed Products": 0,
        "Beef Products": 0,
        "Beverages": 0,
        "Dairy and Egg Products": 0,
        "Legumes and Legume Products": 0,
        "Lamb, Veal, and Game Products": 0,
        "Baked Products": 0,
        "Sweets": 0,
        "Cereal Grains and Pasta": 0,
        "Fast Foods": 0,
        "Meals, Entrees, and Side Dishes": 0,
        "American Indian/Alaska Native Foods": 0,
        "Restaurant Foods": 0,
        "Branded Food Products Database": 0,
        "Quality Control Materials": 0,
        "Finfish and Shellfish Products": 0,
        "Spices and Herbs": 0
      }
    },
    "unit_mappings": {
      "categories_with_mappings": 15,
      "total_categories": 28,
      "unit_types": {
        "other": 78,
        "weight": 20,
        "volume": 10,
        "package": 5,
        "portion": 5,
        "count": 4
      }
    }
  },
  "performance_analysis": {
    "indexes": [
      {
        "table": "usda_category_unit_mappings",
        "name": "usda_category_unit_mappings_category_id_unit_id_key"
      },
      {
        "table": "usda_category_unit_mappings",
        "name": "usda_category_unit_mappings_pkey"
      },
      {
        "table": "usda_food_categories",
        "name": "usda_food_categories_pkey"
      },
      {
        "table": "usda_foods",
        "name": "idx_usda_foods_brand"
      },
      {
        "table": "usda_foods",
        "name": "idx_usda_foods_category"
      },
      {
        "table": "usda_foods",
        "name": "idx_usda_foods_gtin"
      },
      {
        "table": "usda_foods",
        "name": "idx_usda_foods_search"
      },
      {
        "table": "usda_foods",
        "name": "usda_foods_pkey"
      },
      {
        "table": "usda_measure_units",
        "name": "usda_measure_units_pkey"
      },
      {
        "table": "usda_nutrients",
        "name": "usda_nutrients_pkey"
      }
    ],
    "query_times": {
      "food_search_ms": 74.94,
      "category_units_ms": 72.57,
      "foods_by_category_ms": 69.51
    }
  },
  "coverage_analysis": {},
  "indexing_recommendations": [],
  "data_completeness": {},
  "integration_points": {
    "pantry_item_coverage": {
      "matched": 5,
      "total_tested": 20,
      "coverage_percentage": 25.0
    },
    "unit_coverage": {
      "ea": {
        "frequency": 453,
        "in_usda": false
      },
      "can": {
        "frequency": 112,
        "in_usda": true
      },
      "g": {
        "frequency": 68,
        "in_usda": false
      },
      "unit": {
        "frequency": 53,
        "in_usda": true
      },
      "kg": {
        "frequency": 26,
        "in_usda": false
      },
      "lb": {
        "frequency": 21,
        "in_usda": true
      },
      "oz pack": {
        "frequency": 20,
        "in_usda": false
      },
      "oz box": {
        "frequency": 20,
        "in_usda": false
      },
      "each": {
        "frequency": 16,
        "in_usda": true
      },
      "pound": {
        "frequency": 16,
        "in_usda": false
      }
    }
  },
  "recommendations": [
    {
      "priority": "CRITICAL",
      "category": "Missing Data",
      "issue": "usda_food_portions and usda_food_nutrients tables are missing",
      "impact": "Cannot perform unit conversions or provide nutritional data",
      "action": "Import missing USDA data files (food_portion.csv, food_nutrient.csv)",
      "sql": "\n-- Import food portions for unit conversions\nCREATE TABLE usda_food_portions (\n    id SERIAL PRIMARY KEY,\n    fdc_id INTEGER NOT NULL,\n    seq_num INTEGER,\n    amount DECIMAL(10,3),\n    measure_unit_id INTEGER,\n    portion_description VARCHAR(255),\n    modifier VARCHAR(255),\n    gram_weight DECIMAL(10,3),\n    \n    FOREIGN KEY (fdc_id) REFERENCES usda_foods(fdc_id),\n    FOREIGN KEY (measure_unit_id) REFERENCES usda_measure_units(id)\n);\n            "
    },
    {
      "priority": "HIGH",
      "category": "Performance",
      "issue": "Category unit lookup taking 72.6ms",
      "impact": "Slow API responses for unit validation",
      "action": "Add composite index on category_unit_mappings",
      "sql": "CREATE INDEX idx_usda_category_unit_perf ON usda_category_unit_mappings (category_id, usage_percentage DESC, is_preferred);"
    },
    {
      "priority": "HIGH",
      "category": "Coverage",
      "issue": "Only 25.0% of pantry items match USDA foods",
      "impact": "Poor unit validation for real user items",
      "action": "Create fuzzy matching or alias table for common products",
      "sql": "\n-- Create product alias table\nCREATE TABLE product_aliases (\n    id SERIAL PRIMARY KEY,\n    pantry_name VARCHAR(255) NOT NULL,\n    usda_fdc_id INTEGER NOT NULL,\n    confidence_score DECIMAL(3,2),\n    created_by VARCHAR(50) DEFAULT 'system',\n    \n    FOREIGN KEY (usda_fdc_id) REFERENCES usda_foods(fdc_id),\n    UNIQUE(pantry_name)\n);\n            "
    },
    {
      "priority": "MEDIUM",
      "category": "Search Performance",
      "issue": "Food text search could be improved",
      "impact": "Slower food matching for pantry items",
      "action": "Implement full-text search with trigram matching",
      "sql": "\n-- Add trigram extension and index\nCREATE EXTENSION IF NOT EXISTS pg_trgm;\nCREATE INDEX idx_usda_foods_description_trgm ON usda_foods USING GIN (description gin_trgm_ops);\n            "
    },
    {
      "priority": "MEDIUM",
      "category": "Data Quality",
      "issue": "Found 10 duplicate food descriptions",
      "impact": "Inconsistent matching and user confusion",
      "action": "Deduplicate foods or add preference ranking",
      "sql": "\n-- Find and review duplicates\nSELECT description, COUNT(*), ARRAY_AGG(fdc_id) as fdc_ids\nFROM usda_foods \nGROUP BY description \nHAVING COUNT(*) > 1\nORDER BY COUNT(*) DESC;\n            "
    }
  ]
}